
const int message[8][71] = {
  {1,0,0,0,1,0,1,1,1,1,0,1,1,1,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,1,1,1,0},
  {1,1,0,1,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,1,0,1,1,0,0,1,0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,1,0,1,0,0,0,0},
  {1,0,1,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,0,0},
  {1,0,0,0,1,0,1,1,1,0,0,1,1,1,0,0,1,1,1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,1,1,0,0},
  {1,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,0},
  {1,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,0},
  {1,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,0},
  {1,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,1,1,1,0},
};
// const int message[8][72] = {
//   {1,0,0,0,1,0,1,1,1,1,0,1,1,1,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1},
//   {1,1,0,1,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,1,0,1,1,0,0,1,0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,1,0},
//   {1,0,1,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0},
//   {1,0,0,0,1,0,1,1,1,0,0,1,1,1,0,0,1,1,1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1},
//   {1,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0},
//   {1,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0},
//   {1,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0},
//   {1,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1},
// };
// int message[8][65] = {
//   {1,0,0,0,1,0,1,1,1,1,0,1,1,1,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0},
//   {1,1,0,1,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,1,0,1,1,0,0,1,0,1,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0},
//   {1,0,1,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0},
//   {1,0,0,0,1,0,1,1,1,0,0,1,1,1,0,0,1,1,1,0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0},
//   {1,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1,1,1,1,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0},
//   {1,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0},
//   {1,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0},
//   {1,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0},
// };
// int message[8][65] = {0};

int row_pins[8] = {A1, 3, 4, 5, 6, 7, 8, 9};
int col_pins[8] = {10, 11, 12, 13, A5, A4, A3, A2};
int interrupt_pin = 2;
int up = 0;
int down = 0;
int press = 0;
unsigned long previous_millis = 0;
volatile int state = 0;
int matrix[8][8] = {0};
int adder = 0;
// int matrix[8][8] = {
//   {0, 0, 0, 0, 0, 0, 1, 0},
//   {0, 0, 0, 0, 0, 0, 1, 0},
//   {0, 0, 0, 0, 0, 0, 1, 0},
//   {1, 0, 0, 0, 0, 0, 0, 0},
//   {1, 0, 0, 0, 0, 0, 1, 0},
//   {1, 0, 0, 0, 0, 0, 1, 0},
//   {0, 0, 0, 0, 0, 0, 1, 0},
//   {1, 0, 0, 0, 0, 0, 1, 0}
// };

void setup() {
  // put your setup code here, to run once:
  // Serial.begin(57600);
  for (int pin_loc = 0; pin_loc < 8; pin_loc++) {
    pinMode(row_pins[pin_loc], OUTPUT);
    pinMode(col_pins[pin_loc], OUTPUT);
    pinMode(interrupt_pin, INPUT_PULLUP);
    // int matrix = send_matrix(message);
  }
  attachInterrupt(digitalPinToInterrupt(interrupt_pin), press_state, FALLING);

}

void loop() {
  unsigned long current_millis = millis();
  // static int adder = 0;
  // int message[8][65] = message_orig;

  // if (press == 1) {
  //   state++;
  //   if (state > 1) {
  //     state = 0;
  //   }
  //   press = 0;
  //   previous_millis = 0;
  //   adder = 0;
  // }
  // Serial.println(state);

  if (state == 0) {
    for (int i = 0; i < 8; i++) {
      digitalWrite(row_pins[i], LOW);
      digitalWrite(col_pins[i], LOW);
    }
  }

  else if (state > 0) {
    // static int message = message_orig;
    if (current_millis - previous_millis >= 100){
      // int matrix = send_matrix(message, adder);
      // move(message);
      for (int i = 0; i < 8; i++) {
        for (int j = 0; j < 8; j++) {
          matrix[i][j] = message[i][j + adder];
        }
      }
      previous_millis = current_millis;
      adder++;
      if (adder > 66) {
        adder = 0;
      }
      // Serial.println(adder);
    }
    // put your main code here, to run repeatedly:

    // Uncomment below later from here
    // for (int i = 0; i < 8; i++) {
    //   Serial.print(message[i][0]);
    //   if (i < 7) {
    //     Serial.print(",");
    //   }
    // }
    // Serial.println();
    // move(message);
    // delay(2000);
    // To here

    // for (int i = 0; i < 8; i++) {
    //   for (int j = 0; i < 8; j++) {
    //     if (message[i][j] == 0) {
    //       up = 0;
    //       down = 0;
    //     }
    //     else if (message[i][j] == 1) {
    //       up = 1;
    //       down = 0;
    //     }

    //     analogWrite(row_pins[i], up);
    //     analogWrite(col_pins[j], down);
    //   }
    // }

    // digitalWrite(11, 0);
    // for (int i = 0; i < 8; i++) {
    //   digitalWrite(row_pins[i], 1);
    //   digitalWrite(col_pins[i], 0);


    // }
    // for (int i = 10; i < 18; i++) {
    //   digitalWrite(i, 0);
    // }
    for (int i = 0; i < 8; i++) {
      // int sum_i = row_sum(matrix[i]);
      digitalWrite(row_pins[i], HIGH);
      for (int j = 0; j < 8; j++) {
        int elem = matrix[i][j];

        if (elem == 1) {
          down = LOW;
        }
        else if (elem == 0) {
          down = HIGH;
        }
        digitalWrite(col_pins[j], down);
      }
      delay(5);
      digitalWrite(row_pins[i], LOW); // This one is from Chatgpt, I don't understand it yet but I will just put it as is, the one below is from chatgpt as well
      // delay(5);

        // if (sum_i > 0) {
        //   if (elem == 1) {
        //     up = 1;
        //     down = 0;
        //   }

        //   else if (elem == 0) {
        //     up = 1;
        //     down = 1;
        //   }
        // }
        
        // else if (sum_i == 0) {
        //   up = 1;
        //   down = 1;
        // }

        // digitalWrite(row_pins[i], up);
        // digitalWrite(col_pins[j], down);

    }
  }
  // delay(10000);
// Â£nd of loop 
}

// void move (int matrix[8][65]) {
//   for (int i = 0; i < 8; i++) {
//     int elem0 = matrix[i][0];
//     for (int j = 0; j < 64; j++) {
//       matrix[i][j]= matrix[i][j + 1];
//     }
//     matrix[i][64] = elem0;
//   }
// }

int row_sum (int row[]) {
  int sum = 0;
  for (int i = 0; i < 8; i++) {
    sum += row[i];
  }

  return sum;
}

// int send_matrix(int matrix[8][64], int adder) {
//   int array[8][8] = {0};
//   for (int i = 0; i < 8; i++) {
//     for (int j = adder; j < 8 + adder; j++) {
//       array[i][j] = matrix[i][j];
//     }
//   }
//   return array;
// }

void press_state() {
  state++;
  if (state > 1) {
    state = 0;
  }
}
